


<!DOCTYPE html>
<html id="htmlId">
<head>
  <title>Coverage Report > ControllerUtils</title>
  <style type="text/css">
    @import "../../css/coverage.css";
    @import "../../css/idea.min.css";
  </style>
  <script type="text/javascript" src="../../js/highlight.min.js"></script>
  <script type="text/javascript" src="../../js/highlightjs-line-numbers.min.js"></script>
</head>

<body>
<div class="content">
<div class="breadCrumbs">
Current scope:     <a href="../../index.html">all classes</a>
    <span class="separator">|</span>
    <a href="../index.html">ms_312.CheckMeBackend.Controllers</a>
</div>

<h1>Coverage Summary for Class: ControllerUtils (ms_312.CheckMeBackend.Controllers)</h1>

<table class="coverageStats">

<tr>
  <th class="name">Class</th>
<th class="coverageStat 
">
  Method, %
</th>
<th class="coverageStat 
">
  Line, %
</th>
</tr>
<tr>
  <td class="name">ControllerUtils</td>
<td class="coverageStat">
  <span class="percent">
    83.3%
  </span>
  <span class="absValue">
    (5/6)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    88.6%
  </span>
  <span class="absValue">
    (31/35)
  </span>
</td>
</tr>
  <tr>
    <td class="name">ControllerUtils$MessageDateComp</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (2/2)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    100%
  </span>
  <span class="absValue">
    (2/2)
  </span>
</td>
  </tr>
<tr>
  <td class="name"><strong>Total</strong></td>
<td class="coverageStat">
  <span class="percent">
    87.5%
  </span>
  <span class="absValue">
    (7/8)
  </span>
</td>
<td class="coverageStat">
  <span class="percent">
    89.2%
  </span>
  <span class="absValue">
    (33/37)
  </span>
</td>
</tr>
</table>

<br/>
<br/>


<pre>
<code class="sourceCode" id="sourceCode">&nbsp;package ms_312.CheckMeBackend.Controllers;
&nbsp;
&nbsp;import ms_312.CheckMeBackend.Messages.Message;
&nbsp;import ms_312.CheckMeBackend.Users.User;
&nbsp;import ms_312.CheckMeBackend.Users.UserRepository;
&nbsp;
&nbsp;import java.nio.charset.StandardCharsets;
&nbsp;import java.security.MessageDigest;
&nbsp;import java.security.NoSuchAlgorithmException;
&nbsp;import java.util.Arrays;
&nbsp;import java.util.Base64;
&nbsp;import java.util.Comparator;
&nbsp;
&nbsp;/**
&nbsp; * Class which stores utility Methods used by the different Controllers
&nbsp; */
<b class="nc">&nbsp;public class ControllerUtils {</b>
&nbsp;
&nbsp;    /**
&nbsp;     * Object used for comparing two {@link Message}s based on the times there were sent
&nbsp;     */
<b class="fc">&nbsp;    public static class MessageDateComp implements Comparator&lt;Message&gt; {</b>
&nbsp;        @Override
&nbsp;        public int compare(Message o1, Message o2) {
<b class="fc">&nbsp;            return o1.getSendTime().compareTo(o2.getSendTime());</b>
&nbsp;        }
&nbsp;    }
&nbsp;
&nbsp;
&nbsp;
&nbsp;    /**
&nbsp;     * Hashes a string and compares it to the saved hash belonging to a given {@link User}
&nbsp;     *
&nbsp;     * @param user The user to see if the given password is correct for.
&nbsp;     * @param givenPassword The password to attempt to match with the user
&nbsp;     * @return true if the password is correct false if it is not
&nbsp;     *
&nbsp;     * @throws NoSuchAlgorithmException This exception indicates an invalid algorithm name was given to a
&nbsp;     * 	 * {@link MessageDigest} object. The algorithm in this function is hard coded and this should NEVER occur.
&nbsp;     */
&nbsp;    public static Boolean checkPassword(User user, String givenPassword) throws NoSuchAlgorithmException {
&nbsp;
&nbsp;        //Get the salt for this hash
<b class="fc">&nbsp;        byte[] salt = user.getSalt();</b>
&nbsp;
&nbsp;        //Convert the saved hash to bytes for comparison
<b class="fc">&nbsp;        byte[] savedHash = user.getPasswordHash();</b>
&nbsp;
&nbsp;        // Get a MessageDigest object for SHA-512
<b class="fc">&nbsp;        MessageDigest digest = MessageDigest.getInstance(&quot;SHA-512&quot;);</b>
&nbsp;
&nbsp;        // Use the salt in the password hashing
<b class="fc">&nbsp;        digest.update(salt);</b>
&nbsp;
&nbsp;        // Hash the given password
<b class="fc">&nbsp;        byte[] givenPassHash = digest.digest(givenPassword.getBytes(StandardCharsets.UTF_8));</b>
&nbsp;
&nbsp;        //Compare the two hashes and return the result
<b class="fc">&nbsp;        return Arrays.equals(savedHash, givenPassHash);</b>
&nbsp;
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Take in a string passed in the header of a request using &lt;a href=&quot;https://en.wikipedia.org/wiki/Basic_access_authentication&quot;&gt;HTTP Basic Authentification&lt;/a&gt;
&nbsp;     * and separate the base64 encoding from the Basic keyword
&nbsp;     * @param authHeader The string passed in an HTTP request&#39;s authorization header containing Basic Auth to be parsed
&nbsp;     *
&nbsp;     * @return A string containing only the Base64 from the header not the Basic Keyword
&nbsp;     */
&nbsp;    public static String parseBasicAuthHeader(String authHeader){
<b class="fc">&nbsp;        String[] splitHeader = authHeader.split(&quot; &quot;);</b>
<b class="fc">&nbsp;        return splitHeader[1];</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Verifies if a login passed via a Base64 String (HTTP Basic Authentication) is correct.
&nbsp;     * Handles decoding the given String verifying if the USer exists and if the password is correct.
&nbsp;     *
&nbsp;     * @param encodedAuth A Base64 encoded string in the form of &lt;br/&gt;{username}:{password} --
&nbsp;     * &lt;a href=&quot;https://en.wikipedia.org/wiki/Basic_access_authentication&quot;&gt;For more Information&lt;/a&gt;
&nbsp;     *
&nbsp;     * @return
&nbsp;     * true if the User was correctly logged in  -- User exists and  the correct password was given
&nbsp;     * false if the login  failed for any reason
&nbsp;     *
&nbsp;     * @throws NoSuchAlgorithmException This exception indicates an invalid algorithm name was given to a
&nbsp;     * {@link MessageDigest} object. The algorithm in this function is hard coded and this should NEVER occur.
&nbsp;     */
&nbsp;    public static boolean checkBasicAuth(String encodedAuth, UserRepository userRepository) throws NoSuchAlgorithmException{
&nbsp;        //Decode the authorization header
<b class="fc">&nbsp;        byte[] authBytes = Base64.getDecoder().decode(encodedAuth);</b>
<b class="fc">&nbsp;        String auth = new String(authBytes);</b>
&nbsp;
&nbsp;        //Separate the Username and password
<b class="fc">&nbsp;        int authSplit = auth.lastIndexOf(&#39;:&#39;);</b>
<b class="fc">&nbsp;        String username = auth.substring(0, authSplit);</b>
<b class="fc">&nbsp;        String password = auth.substring(authSplit +1);</b>
&nbsp;
&nbsp;        //Find the User with the given Username
<b class="fc">&nbsp;        User authUser = userRepository.findByName(username);</b>
&nbsp;
&nbsp;        //Return false if no such User exists
<b class="fc">&nbsp;        if(authUser == null){</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
&nbsp;        // Return true if the given password is correct and false if it isn&#39;t
<b class="fc">&nbsp;        return checkPassword(authUser, password);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Verifies if a login passed via a Base64 String (HTTP Basic Authentication) is correct.
&nbsp;     * Handles decoding the given String verifying if the USer exists and if the password is correct.
&nbsp;     *
&nbsp;     * @param encodedAuth A Base64 encoded string in the form of &lt;br/&gt;{username}:{password} --
&nbsp;     * &lt;a href=&quot;https://en.wikipedia.org/wiki/Basic_access_authentication&quot;&gt;For more Information&lt;/a&gt;
&nbsp;     * @param authAs The user that the Basic Auth string is being used to authorize as. The encoded username and password
&nbsp;     * must match those saved for this User.
&nbsp;     *
&nbsp;     * @return
&nbsp;     * true if the User was correctly logged in  -- User exists, the correct password was given and they both matched
&nbsp;     * the user to authorize as
&nbsp;     * false if the login  failed for any reason
&nbsp;     *
&nbsp;     * @throws NoSuchAlgorithmException This exception indicates an invalid algorithm name was given to a
&nbsp;     * {@link MessageDigest} object. The algorithm in this function is hard coded and this should NEVER occur.
&nbsp;     */
&nbsp;    public static boolean checkBasicAuth(String encodedAuth, User authAs, UserRepository userRepository) throws NoSuchAlgorithmException{
&nbsp;        //Decode the authorization header
<b class="fc">&nbsp;        byte[] authBytes = Base64.getDecoder().decode(encodedAuth);</b>
<b class="fc">&nbsp;        String auth = new String(authBytes);</b>
&nbsp;
&nbsp;        //Separate the Username and password
<b class="fc">&nbsp;        int authSplit = auth.lastIndexOf(&#39;:&#39;);</b>
<b class="fc">&nbsp;        String username = auth.substring(0, authSplit);</b>
<b class="fc">&nbsp;        String password = auth.substring(authSplit +1);</b>
&nbsp;
&nbsp;        //Find the User with the given Username
<b class="fc">&nbsp;        User authUser = userRepository.findByName(username);</b>
&nbsp;
&nbsp;        //Return false if no such User exists
<b class="fc">&nbsp;        if(authUser == null){</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
&nbsp;        // Confirm that the User is the same as the that is being authorized as
<b class="fc">&nbsp;        if(!authUser.equals(authAs)){</b>
<b class="nc">&nbsp;            return false;</b>
&nbsp;        }
&nbsp;
&nbsp;        // Return true if the given password is correct and false if it isn&#39;t
<b class="fc">&nbsp;        return checkPassword(authUser, password);</b>
&nbsp;    }
&nbsp;
&nbsp;    /**
&nbsp;     * Get the {@link User} with the given username from a Base64 encoded HTTP Basic Authentication String
&nbsp;     * @param encodedAuth
&nbsp;     * @param userRepository
&nbsp;     * @return The {@link User} with the given username
&nbsp;     */
&nbsp;    public static User getUsername(String encodedAuth, UserRepository userRepository){
<b class="fc">&nbsp;        byte[] authBytes = Base64.getDecoder().decode(encodedAuth);</b>
<b class="fc">&nbsp;        String auth = new String(authBytes);</b>
&nbsp;
&nbsp;        //Separate the Username and password
<b class="fc">&nbsp;        int authSplit = auth.lastIndexOf(&#39;:&#39;);</b>
<b class="fc">&nbsp;        String username = auth.substring(0, authSplit);</b>
&nbsp;
&nbsp;        //Find the User with the given Username
<b class="fc">&nbsp;        User authUser = userRepository.findByName(username);</b>
<b class="fc">&nbsp;        return authUser;</b>
&nbsp;    }
&nbsp;
&nbsp;}
</code>
</pre>
</div>

<script type="text/javascript">
(function() {
    var msie = false, msie9 = false;
    /*@cc_on
      msie = true;
      @if (@_jscript_version >= 9)
        msie9 = true;
      @end
    @*/

    if (!msie || msie && msie9) {
      hljs.highlightAll()
      hljs.initLineNumbersOnLoad();
    }
})();
</script>

<div class="footer">
    
    <div style="float:right;">generated on 2023-12-05 14:47</div>
</div>
</body>
</html>
